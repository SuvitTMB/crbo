<!--
	https://www.youtube.com/watch?v=ofZg0J4LR5Q
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>LINE Retail Society</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href='css/ekachon.css' rel="stylesheet" type="text/css">
  <link href='css/style.css?ver=0001' rel="stylesheet" type="text/css">
  <link href='css/table.css' rel="stylesheet" type="text/css">
  <link href='css/dropdown.css' rel="stylesheet" type="text/css">


<!--
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
-->
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js"></script>
</head>
<body style="font-size: 12px;">


	<div id="FormAdd" style="display: none; margin:auto;width:90%;" class="t-table">
		<div style="color:#0056ff;text-align: center;padding:8px;font-weight: 600;">รายละเอียดข้อมูลรายงาน</div>
		<div style="width:100px;float: left;">GroupReport</div>
		<div style="width:100%;">
          <select id="txtGroupReport" class="input">
            <option value="Staff_1">Staff-1 (TOP 3 of the DAY)</option>
            <option value="Staff_2">Staff-2 (TOP of the MONTH)</option>
            <option value="Staff_3">Staff-3 (TOP of the YEAR)</option>
            <option value="Staff_4">Staff-4 (TOP Face Recognition)</option>
            <option value="BM_1">BM-1 (TOP Digital Transaction)</option>
            <option value="BM_2">BM-2 (TOP Digital KPI)</option>
            <option value="RH_1">RH-1 (TOP ZONE HEAD)</option>
            <option value="RH_2">RH-2 (TOP REGIONAL HEAD)</option>
          </select>
        </div>
<!--
			<input type="text" id="txtGroupReport" class="input">
		</div>
-->
		<div style="width:100px;float: left;">ลำดับที่</div>
		<div style="width:100%;"><input type="text" id="txtReportNo" class="input"></div>
		<div style="width:100px;float: left;">ReportDate</div>
		<div style="width:100%;"><input type="text" id="txtReportDate" class="input"></div>
		<div style="width:100px;float: left;">DataJson</div>
		<div style="width:100%;margin-top:2px;"><textarea class="textarea" id="txtDataJson"></textarea></div>
		<div style="width:100px;float: left;">ประกาศผล</div>
		<div style="width:100%;"><input type="text" id="txtImg" class="input"></div>
		<div style="width:100px;float: left;">.</div>
		<div style="width:100%;margin-top:2px;">
			<button onclick="AddData(document.getElementById('txtGroupReport').value, document.getElementById('txtReportNo').value, document.getElementById('txtReportDate').value, document.getElementById('txtDataJson').value, document.getElementById('txtImg').value)">Save</button>
		</div>	
	</div>
	<div class="clr"></div>
	<div class="t-table" stye="margin:auto;">
		<center>
			<div style="margin-top: 25px ;color:#0056ff;padding:8px;font-weight: 600;">รายงานข้อมูลการแข่งขัน 
				| <a href="https://csvjson.com/csv2json" target="_Blank">แปล File เป็น Json</a> |</div>
			<div class="col">
				<center>
					<span class="dropdown-container" style="margin-top:-5px; margin-bottom:15px;">
			          <select id="SelectGroup" onchange="getListValue()" class="input" style="width:250px;background: #f68b1f; color:#ffffff;border-radius: 10px;cursor: pointer;">
			            <option value="Staff_1">Staff-1 (TOP 3 of the DAY)</option>
			            <option value="Staff_2">Staff-2 (TOP of the MONTH)</option>
			            <option value="Staff_3">Staff-3 (TOP of the YEAR)</option>
			            <option value="Staff_4">Staff-4 (TOP Face Recognition)</option>
			            <option value="BM_1">BM-1 (TOP Digital Transaction)</option>
			            <option value="BM_2">BM-2 (TOP Digital KPI)</option>
			            <option value="RH_1">RH-1 (TOP ZONE HEAD)</option>
			            <option value="RH_2">RH-2 (TOP REGIONAL HEAD)</option>
			          </select>
					</span>
					<span><button onclick="AddRec()">Add</button></span>
				</center>
			</div>
		</center>
		<ul id="show" class="showInColumn"></ul>
	</div>


<script type="text/javascript">

var Eid = "";
var sGroupReport = "Staff-1";
var _0x2223a8=_0x4a06;function _0x4a06(_0x58d05f,_0x37522b){var _0x51897b=_0x5189();return _0x4a06=function(_0x4a065c,_0x574a38){_0x4a065c=_0x4a065c-0xa6;var _0x5ad908=_0x51897b[_0x4a065c];return _0x5ad908;},_0x4a06(_0x58d05f,_0x37522b);}function _0x5189(){var _0x4c9d9a=['1193208OLbmRR','retailproject-6f4fc.firebaseapp.com','793537bcfEnc','1029280khHJRm','AIzaSyDfTJJ425U4OY0xac6jdhtSxDeuJ-OF-lE','3048VLbdVv','retailproject-6f4fc','653667385625','15090327YLbHCA','3241BeunWp','20392sIqUAD','retailproject-6f4fc.appspot.com','380qTLowL','1133772GbhIaw','G-9SKTRHHSW9'];_0x5189=function(){return _0x4c9d9a;};return _0x5189();}(function(_0xd95154,_0xe1abc4){var _0xb84bf7=_0x4a06,_0x110b75=_0xd95154();while(!![]){try{var _0x27bd57=-parseInt(_0xb84bf7(0xab))/0x1+-parseInt(_0xb84bf7(0xa9))/0x2+-parseInt(_0xb84bf7(0xa7))/0x3+-parseInt(_0xb84bf7(0xb3))/0x4*(-parseInt(_0xb84bf7(0xa6))/0x5)+parseInt(_0xb84bf7(0xae))/0x6*(parseInt(_0xb84bf7(0xb2))/0x7)+-parseInt(_0xb84bf7(0xac))/0x8+parseInt(_0xb84bf7(0xb1))/0x9;if(_0x27bd57===_0xe1abc4)break;else _0x110b75['push'](_0x110b75['shift']());}catch(_0x436a60){_0x110b75['push'](_0x110b75['shift']());}}}(_0x5189,0x624c6));var firebaseConfig={'apiKey':_0x2223a8(0xad),'authDomain':_0x2223a8(0xaa),'projectId':_0x2223a8(0xaf),'storageBucket':_0x2223a8(0xb4),'messagingSenderId':_0x2223a8(0xb0),'appId':'1:653667385625:web:a5aed08500de80839f0588','measurementId':_0x2223a8(0xa8)};

//firebase.initializeApp(firebaseConfig);
//var db = firebase.firestore().collection("Report");

var _0x2de511=_0x1926;function _0x1926(_0x30734a,_0x5b3bbd){var _0x73f665=_0x73f6();return _0x1926=function(_0x192674,_0x14d42e){_0x192674=_0x192674-0xdd;var _0x597ecc=_0x73f665[_0x192674];return _0x597ecc;},_0x1926(_0x30734a,_0x5b3bbd);}(function(_0x47b941,_0x21d585){var _0x99722d=_0x1926,_0x5afd7d=_0x47b941();while(!![]){try{var _0x9b5d92=parseInt(_0x99722d(0xe1))/0x1*(parseInt(_0x99722d(0xe9))/0x2)+-parseInt(_0x99722d(0xe6))/0x3+-parseInt(_0x99722d(0xe3))/0x4+parseInt(_0x99722d(0xe2))/0x5*(-parseInt(_0x99722d(0xe4))/0x6)+parseInt(_0x99722d(0xe7))/0x7+-parseInt(_0x99722d(0xe5))/0x8*(parseInt(_0x99722d(0xdf))/0x9)+parseInt(_0x99722d(0xde))/0xa*(parseInt(_0x99722d(0xe8))/0xb);if(_0x9b5d92===_0x21d585)break;else _0x5afd7d['push'](_0x5afd7d['shift']());}catch(_0x452ee7){_0x5afd7d['push'](_0x5afd7d['shift']());}}}(_0x73f6,0x7772b),firebase[_0x2de511(0xea)](firebaseConfig));function _0x73f6(){var _0x5162a4=['33YHxiSJ','726230iHTRcS','initializeApp','firestore','5402910hvuKti','9bbneWQ','collection','1YcZXNZ','110560keMpou','1350632PwZPuc','24NBBjSR','4999744QlSEDg','2005383pBWdXK','1573642FrTUWr'];_0x73f6=function(){return _0x5162a4;};return _0x73f6();}var db=firebase[_0x2de511(0xdd)]()[_0x2de511(0xe0)]('Report');


getListValue();




function getListValue() {
	var selectedOption, st;
	//var selectedOption;
	selectedOption = document.getElementById("SelectGroup").selectedIndex;
	st = document.getElementById("SelectGroup").options[selectedOption].value;
	if(st!="") { sGroupReport = st; }
	document.getElementById('FormAdd').style.display = 'none';
	ReadData();
	//alert(sGroupReport);
	//document.getElementById("myTextBoxResult").value=st;
}


//ReadData();

//AddData('Staff','09/08/2564','[{"Rank": 1,"Bank": "TBANK","Branch Name": "สาขาบางนา","Zone": "บางนา","Region": "RH1","Score": "83.88%"},{"Rank": 649,"Bank": "TBANK","Branch Name": "สาขาบิ๊กซี บางพลี","Zone": "บางนา","Region": "RH1","Score": "73.70%"}]');

function ReadData() {
  //alert(sGroupReport);
  document.getElementById("show").innerHTML = "";
  //db.where('GroupReport','==',sGroupReport)
  //db.orderBy('GroupReport')
  db.where('GroupReport','==',sGroupReport)
  .orderBy('ReportNo','desc')
  .onSnapshot(function(snapshot) {
    snapshot.docChanges().forEach(function(change) {
    	if(change.type === "added") {
    		ShowData(change.doc);
    	}
    	if(change.type === "modified") {
    		//document.getElementById("show").innerHTML = "";
    		UpdateData(change.doc);
    	}
    	if(change.type === "removed") {
    		var node = document.getElementById("L_"+change.doc.id);
    		node.parentNode.removeChild(node);
    	}
    });
  });
}


function UpdateData(doc) {
//document.getElementById("show").innerHTML = "";
	var node = document.createElement("LI");
	node.innerHTML = "";	
	var t1 = document.createTextNode(' | '+doc.data().GroupReport);
	var t2 = document.createTextNode(' | No. ' + doc.data().ReportNo);
	var t3 = document.createTextNode(' | ' + doc.data().ReportDate);
	var t4 = document.createTextNode(doc.data().DataJson);
	var t5 = document.createTextNode(doc.data().ReportImg);
	node.appendChild(t1);
	node.appendChild(t2);
	node.appendChild(t3);
	//node.appendChild(t3);

	var b = document.createElement("BUTTON");
	b.innerHTML = "delete";
	b.addEventListener("click", function() {
		RemoveData(doc.id);
	});
	node.appendChild(b);


	var b2 = document.createElement("BUTTON");
	b2.innerHTML = "edit";
	b2.addEventListener("click", function() {
		EditData(doc.id,doc.data().GroupReport,doc.data().ReportNo,doc.data().ReportDate,doc.data().DataJson,doc.data().ReportImg);
	});
	node.appendChild(b2);
	
}



function ShowData(doc) {
  	//document.getElementById("show").innerHTML = "";
	var ul = document.getElementById("show");
	var node = document.createElement("LI");
	node.id = "L_"+doc.id;
	var t1 = document.createTextNode(' | '+doc.data().GroupReport);
	var t2 = document.createTextNode(' | No. ' + doc.data().ReportNo);
	var t3 = document.createTextNode(' | ' + doc.data().ReportDate);


	//var t1 = document.createTextNode(' | '+doc.data().GroupReport+' |  ');
	//var t2 = document.createTextNode(doc.data().ReportDate);
	//var t3 = document.createTextNode(doc.data().DataJson)
	//node.appendChild(t1);
	//node.appendChild(t2);
	//node.appendChild(t3);

	var b = document.createElement("BUTTON");
	b.innerHTML = "delete";
	b.addEventListener("click", function() {
		RemoveData(doc.id);
	});
	node.appendChild(b);


	var b2 = document.createElement("BUTTON");
	b2.innerHTML = "edit";
	b2.addEventListener("click", function() {
		EditData(
			doc.id,
			doc.data().GroupReport,
			doc.data().ReportNo,
			doc.data().ReportDate,
			doc.data().DataJson,
			doc.data().ReportImg
		);
	});
	node.appendChild(b2);

	//node.appendChild(t1);
	node.appendChild(t2);
	node.appendChild(t3);

	ul.appendChild(node);
}


function RemoveData(id) {
	db.doc(id).delete();
	alert("Remove Record Done");
    document.getElementById('FormAdd').style.display = 'none';
}


function EditData(id,a1,a2,a3,a4,a5) {
	Eid = id;
	document.getElementById("txtGroupReport").value = a1;
	document.getElementById("txtReportNo").value = a2;
	document.getElementById("txtReportDate").value = a3;
	document.getElementById("txtDataJson").value = a4;
	document.getElementById("txtImg").value = a5;
    document.getElementById('FormAdd').style.display = 'block';
}


function AddData(a1,a2,a3,a4,a5) {
	if(a1!="" && a2!="" && a3!="") {
		if(Eid=="") {
		  db.add({
		    GroupReport : a1,
		    ReportNo : parseInt(a2),
		    ReportDate : a3,
		    DataJson : a4,
		    ReportImg : a5
		  });
		} else {
			db.doc(Eid).update({
			    GroupReport : a1,
			    ReportNo : parseInt(a2),
			    ReportDate : a3,
			    DataJson : a4,			
		    	ReportImg : a5
			});
			Eid = "";
			document.getElementById("txtGroupReport").value = "";
			document.getElementById("txtReportNo").value = "";
			document.getElementById("txtReportDate").value = "";
			document.getElementById("txtDataJson").value = "";
			document.getElementById("txtImg").value = "";
			ReadData();
			//alert("Save Done");
		}
	} else {
		alert("กรณีเพิ่มข้อมูลใหม่ต้องกรอกข้อมูลให้ครบถ้วน");
	}
    //document.getElementById("show").innerHTML = "";
	document.getElementById('FormAdd').style.display = 'none';
	//ReadData();

}


function AddRec() {
    document.getElementById('FormAdd').style.display = 'block';
}




</script>
</body>
</html>
